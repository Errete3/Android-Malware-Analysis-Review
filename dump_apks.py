import os
from apk_tools import ApkExtractor

class FeatureExtractor:

    manifest_features = set()

    def __init__(self, apks_dir, label):
        self.apks_dir = apks_dir
        self.label = label
        self.apks_paths = [os.path.join(self.apks_dir,apk) for apk in os.listdir(self.apks_dir)]
        self.apks_data = []
        self.apks_features = []

    def dump_data(self, gatherFeatures=True):
        for apk_path in self.apks_paths:
            data = ApkExtractor(apk_path)
            manifest_data = data.get_manifest_data()
            manifest_data = manifest_data['permissions'] + manifest_data['intent_filter_action'] + manifest_data['intent_filter_category']
            self.apks_data.append(manifest_data)
            if gatherFeatures == True:
                FeatureExtractor.manifest_features.update(manifest_data)

    def get_features(self):
        for apk_data in self.apks_data:
            features = []
            for feature in FeatureExtractor.manifest_features:
                if feature in apk_data:
                    features.append(1)
                else:
                    features.append(0)
            self.apks_features.append(features)
        return self.apks_features
    
    def get_labels(self):
        return [self.label] * len(self.apks_features)

malware = FeatureExtractor('/Users/jaime/Desktop/APKS/PREDICTIONS_MAL/',1); 
malware.dump_data(False); 